<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
    <title>Admin Overview | Croevo AI</title>
</head>
<body>

<nav class="sidebar">
    <h3 class="gradient-text">CROEVO ADMIN</h3>
    <ul class="nav-menu">
        <li><a href="dashboard.html" class="active">Overview</a></li>
        <li><a href="memo-gen.html">Memo Generator</a></li>
        <li><a href="news-post.html">Announcements</a></li>
        <li><a href="team-manage.html">Team Control</a></li>
        <li><a href="subscribers.html">Subscribers</a></li>
        <li><a href="settings.html">Settings</a></li>
    </ul>
</nav>

<div class="main-content">
    <h2 class="gradient-text">Dashboard Overview</h2>
    
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
        <div class="admin-card" style="text-align: center;">
            <p style="color: #94a3b8; margin-bottom: 5px;">Total Memos Issued</p>
            <h1 id="statMemos" style="color: var(--primary); font-size: 2.5rem;">0</h1>
        </div>
        <div class="admin-card" style="text-align: center;">
            <p style="color: #94a3b8; margin-bottom: 5px;">Active Team Members</p>
            <h1 id="statTeam" style="color: var(--primary); font-size: 2.5rem;">0</h1>
        </div>
        <div class="admin-card" style="text-align: center;">
            <p style="color: #94a3b8; margin-bottom: 5px;">Public Announcements</p>
            <h1 id="statNews" style="color: var(--primary); font-size: 2.5rem;">0</h1>
        </div>
    </div>

    <div class="admin-card">
        <h3 style="margin-bottom: 20px; border-bottom: 1px solid var(--glass-border); padding-bottom: 10px;">Recent Memos</h3>
        <div id="recentMemosList">
            <p style="color: #94a3b8;">Loading recent logs...</p>
        </div>
    </div>
</div>

<script type="module">
    import { supabase } from '../js/supabase-config.js';

    async function loadStats() {
        // 1. Fetch Counts from all three tables
        const { count: memoCount } = await supabase.from('memos').select('*', { count: 'exact', head: true });
        const { count: teamCount } = await supabase.from('team').select('*', { count: 'exact', head: true });
        const { count: newsCount } = await supabase.from('news').select('*', { count: 'exact', head: true });

        // Update UI stats
        document.getElementById('statMemos').innerText = memoCount || 0;
        document.getElementById('statTeam').innerText = teamCount || 0;
        document.getElementById('statNews').innerText = newsCount || 0;

        // 2. Fetch last 5 memos for the activity feed
        const { data: recentMemos, error } = await supabase
            .from('memos')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(5);

        if (recentMemos) {
            document.getElementById('recentMemosList').innerHTML = recentMemos.map(m => `
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <span><strong>${m.memo_id}</strong> - ${m.recipient}</span>
                    <span style="color: #94a3b8; font-size: 0.85rem;">${m.issued_date}</span>
                </div>
            `).join('');
        }
    }

    // Run on page load
    loadStats();
</script>

</body>
</html>