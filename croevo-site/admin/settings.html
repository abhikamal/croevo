<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
    <title>Settings | Croevo AI</title>
</head>
<body>

<nav class="sidebar">
    <h3 class="gradient-text">CROEVO ADMIN</h3>
    <ul class="nav-menu">
        <li><a href="dashboard.html">Overview</a></li>
        <li><a href="memo-gen.html">Memo Generator</a></li>
        <li><a href="news-post.html">Announcements</a></li>
        <li><a href="team-manage.html">Team Control</a></li>
        <li><a href="subscribers.html">Subscribers</a></li>
        <li><a href="settings.html" class="active">Settings</a></li>
    </ul>
</nav>

<div class="main-content">
    <h2 class="gradient-text">⚙️ System Settings</h2>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        <div class="admin-card">
            <h3 style="margin-bottom: 20px;">Security & Password</h3>
            <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 15px;">Update the password used to access this dashboard.</p>
            
            <label>New Password</label>
            <input type="password" id="newPass" class="admin-input" placeholder="Min 6 characters">
            
            <label>Confirm Password</label>
            <input type="password" id="confirmPass" class="admin-input" placeholder="Repeat new password">
            
            <button id="updatePassBtn" class="btn-primary" style="width: 100%;">Update Password</button>
        </div>

        <div class="admin-card">
            <h3 style="margin-bottom: 20px;">API Configuration</h3>
            <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 15px;">These keys connect your frontend to the Supabase Cloud.</p>
            
            <label>Supabase Project URL</label>
            <input type="text" id="configUrl" class="admin-input" readonly style="opacity: 0.6; cursor: not-allowed;">
            
            <label>Anon Public Key</label>
            <input type="text" id="configKey" class="admin-input" readonly style="opacity: 0.6; cursor: not-allowed;">
            
            <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid var(--primary); padding: 10px; border-radius: 8px; font-size: 0.8rem; color: var(--primary);">
                ⚠️ For security, keys are managed in <code>js/supabase-config.js</code>.
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { supabase } from '../js/supabase-config.js';

    // 1. Populate API config fields for reference
    async function loadConfig() {
        const { supabaseUrl, supabaseKey } = supabase;
        document.getElementById('configUrl').value = supabaseUrl || "Protected";
        document.getElementById('configKey').value = supabaseKey ? "••••••••••••••••" : "Not Found";
    }

    // 2. Handle Password Update
    document.getElementById('updatePassBtn').onclick = async () => {
        const newPass = document.getElementById('newPass').value;
        const confirmPass = document.getElementById('confirmPass').value;

        if (newPass.length < 6) {
            alert("Password must be at least 6 characters.");
            return;
        }

        if (newPass !== confirmPass) {
            alert("Passwords do not match.");
            return;
        }

        const { error } = await supabase.auth.updateUser({
            password: newPass
        });

        if (error) {
            alert("Update Failed: " + error.message);
        } else {
            alert("Password updated successfully! Please login again.");
            await supabase.auth.signOut();
            window.location.href = "login.html";
        }
    };

    loadConfig();
</script>

</body>
</html>