<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Verify Memo | Croevo AI</title>
</head>
<body>

    <nav class="navbar">
        <div class="logo"><strong>CROEVO AI</strong></div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="newsletter.html">News</a>
            <a href="team.html">Our Team</a>
            <a href="verifier.html">Memo Verifier</a>
        </div>
    </nav>

    <div class="container" style="max-width: 600px; margin-top: 5rem;">
        <h2 class="gradient-text" style="text-align: center;">Document Verification</h2>
        <p style="text-align: center; color: #94a3b8;">Enter the unique Memo ID to check its authenticity in our secure records.</p>
        
        <div class="verifier-box glass" style="padding: 2rem; margin-top: 2rem; display: flex; gap: 10px;">
            <input type="text" id="memoIdInput" placeholder="Ex: CRV-101" style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); color: white;">
            <button id="verifyBtn" class="btn-primary">Verify Now</button>
        </div>

        <div id="resultArea" class="glass" style="margin-top: 2rem; padding: 2rem; display: none;">
            </div>
    </div>

    <script type="module">
        import { supabase } from './js/supabase-config.js';

        async function verifyMemo() {
            const inputId = document.getElementById('memoIdInput').value.trim();
            const resultArea = document.getElementById('resultArea');

            if (!inputId) {
                alert("Please enter a Memo ID.");
                return;
            }

            // Show loading state
            resultArea.style.display = "block";
            resultArea.innerHTML = `<p style="color: var(--primary); text-align: center;">üîç Querying secure database...</p>`;

            try {
                // Query the 'memos' table in Supabase
                const { data, error } = await supabase
                    .from('memos')
                    .select('*')
                    .eq('memo_id', inputId)
                    .single();

                if (error) throw error;

                if (data) {
                    resultArea.innerHTML = `
                        <div style="text-align: center; margin-bottom: 1rem;">
                            <span style="background: rgba(34, 197, 94, 0.2); color: var(--primary); padding: 5px 15px; border-radius: 20px; font-weight: bold;">‚úÖ AUTHENTIC DOCUMENT</span>
                        </div>
                        <div style="border-top: 1px solid var(--glass-border); padding-top: 1rem;">
                            <p><strong>Issued To:</strong> ${data.recipient}</p>
                            <p><strong>Purpose:</strong> ${data.purpose}</p>
                            <p><strong>Issue Date:</strong> ${new Date(data.issued_date).toLocaleDateString()}</p>
                        </div>
                    `;
                }
            } catch (err) {
                console.error("Verification Error:", err.message);
                resultArea.innerHTML = `
                    <div style="text-align: center; color: #ef4444;">
                        <p>‚ùå <strong>Document Not Found</strong></p>
                        <p style="font-size: 0.85rem; color: #94a3b8;">The ID provided does not match any records in the Croevo AI system.</p>
                    </div>
                `;
            }
        }

        // Link the button to the function
        document.getElementById('verifyBtn').addEventListener('click', verifyMemo);
    </script>
</body>
</html>